{
  "buildDate": "2025-11-02T19:41:09.000Z",
  "version": "1.0.36",
  "git": {
    "commitMessage": "fix(frontend): Fix ActiveGames CORS error by using correct env variable",
    "commitHash": "b3fe2c6",
    "commitDate": "2025-11-02 14:40:16 -0500",
    "branch": "main"
  },
  "latestDoneFeatures": [
    {
      "date": "2025-11-02",
      "title": "Connection Stability & Bot Autonomy Fixes",
      "features": [
        "Fixed bot freezing - Added server-side bot action scheduling",
        "Bots now independent of frontend sockets (schedule actions automatically)",
        "Disabled duplicate ConnectionManager heartbeat causing mass disconnections",
        "Socket.IO built-in ping/pong now sole heartbeat mechanism (60s timeout)",
        "Removed duplicate emitGameUpdate on disconnect (prevented update cascades)",
        "Bot actions scheduled at all turn transitions (betting, playing, post-trick)",
        "Games with bots now visible in lobby browser (isJoinable includes bot replacement)",
        "In-progress games now shown in lobby for spectating",
        "Fixed ActiveGames CORS error (VITE_API_URL ‚Üí VITE_SOCKET_URL)"
      ]
    },
    {
      "date": "2025-11-02",
      "title": "Empty Seat System",
      "features": [
        "Players leaving games create empty seats instead of being removed",
        "Empty seats preserve team assignments and positions",
        "New players can fill empty seats via TeamSelection 'Fill Seat' button",
        "Backend: fill_empty_seat socket handler with session management",
        "Frontend: Consistent empty seat UI across all phases (üí∫, gray, dashed borders)",
        "LobbyBrowser shows empty seat count for each game",
        "Reconnection compatibility: Empty seats cannot reconnect (must fill seat)",
        "15-min disconnect timeout creates empty seats instead of removing players"
      ]
    },
    {
      "date": "2025-11-02",
      "title": "Round Summary Enhancements",
      "features": [
        "Fixed last trick visibility - shows for 2 seconds before round summary",
        "Added TrickHistory component to round summary",
        "Fixed Team MVP calculation bug (was showing >100%)",
        "Made round points delta prominent with large +X display"
      ]
    },
    {
      "date": "2025-11-02",
      "title": "Game Management Improvements",
      "features": [
        "Filter obsolete 6-character game IDs from lobby displays",
        "Added admin cleanup endpoint: POST /api/admin/cleanup-observelete-games",
        "Show player names in Online page with socket ID fallback"
      ]
    }
  ],
  "lastSession": {
    "date": "2025-11-02",
    "summary": "Fixed critical connection timeouts and bot freezing issues",
    "achievements": [
      "üîß Root Cause Analysis: ConnectionManager duplicate heartbeat system",
      "  - ConnectionManager sent custom 'ping' events every 25s",
      "  - Clients don't have handlers for custom ping (only Socket.IO built-in)",
      "  - After 60s without pong, forced disconnect ‚Üí reconnection loops",
      "  - Disabled ConnectionManager.startHeartbeat()",
      "  - Now relies solely on Socket.IO's built-in ping/pong",
      "",
      "ü§ñ Bot Action Scheduling (Server-Side Autonomy):",
      "  - Added handlePlayingTimeout and handleBettingTimeout to gameplay deps",
      "  - Bots schedule actions (2s delay) when turn advances:",
      "    * After card play (gameplay.ts:363-382)",
      "    * After bet placement for betting/playing phases (gameplay.ts:230-265)",
      "    * After trick resolution if winner is bot (index.ts:1079-1098)",
      "    * New round start if first player is bot (index.ts:1034-1047)",
      "  - Bots no longer depend on frontend socket connections",
      "",
      "üì° Removed Duplicate emitGameUpdate:",
      "  - Disconnect handler no longer calls emitGameUpdate (connection.ts:363-364)",
      "  - Prevents update cascade during mass disconnections",
      "  - Game state unchanged on disconnect (only connectionStatus)",
      "",
      "üéÆ Lobby Browser Improvements:",
      "  - Show in-progress games for spectating (routes.ts:646)",
      "  - Games with bots marked as joinable (bot takeover flow)",
      "  - Filter: isJoinable OR isInProgress (not just isJoinable)",
      "",
      "üåê Fixed ActiveGames Component:",
      "  - Changed VITE_API_URL ‚Üí VITE_SOCKET_URL for consistency",
      "  - All components now use same env variable",
      "  - Better error messages for network failures"
    ],
    "commits": 4,
    "linesChanged": "~180 added, ~25 modified",
    "filesModified": [
      "backend/src/connection/ConnectionManager.ts",
      "backend/src/socketHandlers/connection.ts",
      "backend/src/socketHandlers/gameplay.ts",
      "backend/src/utils/broadcastManager.ts",
      "backend/src/index.ts",
      "backend/src/api/routes.ts",
      "frontend/src/components/ActiveGames.tsx"
    ],
    "technicalDetails": {
      "rootCause": "Duplicate heartbeat system - ConnectionManager vs Socket.IO built-in",
      "primaryFix": "Disabled ConnectionManager custom heartbeat, rely on Socket.IO (60s timeout)",
      "secondaryFix": "Server-side bot scheduling makes bots autonomous from frontend",
      "impactedSystems": [
        "Connection management (heartbeat/ping-pong)",
        "Bot action lifecycle (betting + playing phases)",
        "Game state broadcasting (disconnect handling)",
        "Lobby visibility (joinable games with bots)"
      ]
    }
  },
  "futureTodos": [
    "Sprint 6: E2E Test Refactoring - Single-browser architecture for stability",
    "Redis Caching Layer - Further optimize database usage",
    "WebSocket Integration Tests - Backend multi-player test suite",
    "CI/CD Pipeline - Automated deployment and testing",
    "Improve Bot AI - Advanced strategy and card tracking",
    "Enhanced Leaderboard - Charts, statistics, and CSV export",
    "Performance optimization - Bundle splitting and code optimization",
    "Mobile UX improvements - Touch gestures and responsive tweaks",
    "Tournament mode - Bracket system for competitive play",
    "Replay system enhancements - Download/share replays"
  ]
}
